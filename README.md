# 지구화학 데이터 분석기

Next.js + TypeScript + Supabase + Vercel로 구축된 웹 기반 지구화학 데이터 분석 도구입니다.

## 🚀 주요 기능

### 📁 데이터 관리
- **파일 업로드**: Excel (.xlsx) 및 CSV 파일 지원
- **드래그 앤 드롭**: 쉬운 파일 업로드 인터페이스
- **타입별 분류**: 암석 타입, 샘플 그룹 등 카테고리별 색상 구분

### 📊 통계 분석
- **상관계수**: 피어슨, 스피어만 상관계수 계산
- **선형 회귀**: 최소제곱법 기반 회귀선 및 R² 계산
- **타입별 통계**: 각 그룹별 독립적인 통계 분석
- **유의성 검정**: t-검정 기반 p-값 자동 계산

### 📈 고급 시각화
- **로그 스케일**: X/Y축 독립적인 로그 스케일 지원
- **축 반전**: X축/Y축 반전 (지질학 깊이 프로파일 등)
- **1:1 비율**: 정사각형 플롯으로 1:1 비교 가능
- **1:1 참조선**: y=x 대각선 표시
- **커스텀 축 범위**: 수동 범위 설정 및 눈금 간격 조정

### 🎨 차트 커스터마이징
- **숫자 형식**: 일반/과학적 표기법/천 단위 구분
- **위첨자 표기**: 10⁴ 형식의 지수 표현
- **마커 스타일**: 모양, 크기, 불투명도, 테두리 조정
- **색상 팔레트**: 타입별 사용자 정의 색상 (최대 8색)
- **데이터 라벨**: 각 포인트에 타입 이름 표시
- **추세선**: 전체/타입별 추세선 표시 및 스타일 조정
- **차트 제목**: 커스텀 제목 및 위치 조정
- **오차범위**: X/Y축 독립적 설정 (백분율/고정값/컬럼/표준편차/표준오차)

### 💾 내보내기
- **PNG 저장**: 고해상도 래스터 이미지 (2x scale)
- **SVG 저장**: 확대 가능한 벡터 그래픽 (배경색 포함)

### 🖥️ 사용자 경험
- **반응형 레이아웃**: 큰 화면은 좌우 배치, 작은 화면은 상하 배치
- **패널 하이라이트**: 열린 설정 패널 시각적 구분
- **실시간 미리보기**: 모든 설정 즉시 반영

> 📖 더 자세한 기능 설명은 [FEATURES.md](./FEATURES.md)를 참조하세요.

## 🛠️ 기술 스택

- **Frontend**: Next.js 14, TypeScript, Tailwind CSS
- **Charts**: Recharts
- **Database**: Supabase
- **Deployment**: Vercel
- **File Processing**: xlsx, papaparse
- **Statistics**: simple-statistics
- **Icons**: Lucide React

## 📋 설치 및 실행

### 1. Node.js 설치
```bash
# https://nodejs.org에서 LTS 버전 다운로드
# 또는 winget 사용 (Windows)
winget install OpenJS.NodeJS
```

### 2. 의존성 설치
```bash
npm install
```

### 3. 환경 변수 설정
`.env.local` 파일을 생성하고 다음을 추가:
```env
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key
OPENAI_API_KEY=your-openai-api-key
```

### 4. 개발 서버 실행
```bash
npm run dev
```

브라우저에서 [http://localhost:3000](http://localhost:3000)을 열어 확인하세요.

## 🗄️ Supabase 설정

### 1. Supabase 프로젝트 생성
1. [supabase.com](https://supabase.com)에서 새 프로젝트 생성
2. Database > SQL Editor에서 다음 테이블 생성:

```sql
-- 지구화학 데이터 저장 테이블
create table geochem_data (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users default auth.uid(),
  file_name text not null,
  data jsonb not null,
  metadata jsonb not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Row Level Security 활성화
alter table geochem_data enable row level security;

-- 정책 생성
create policy "Users can insert their own data" on geochem_data
  for insert with check (auth.uid() = user_id);

create policy "Users can view their own data" on geochem_data
  for select using (auth.uid() = user_id);

create policy "Users can update their own data" on geochem_data
  for update using (auth.uid() = user_id);

create policy "Users can delete their own data" on geochem_data
  for delete using (auth.uid() = user_id);

-- GPT 4o 대피소 채팅 세션 테이블
create table chat_sessions (
  id uuid default gen_random_uuid() primary key,
  session_id text not null,
  messages jsonb not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 세션 ID에 대한 인덱스 (빠른 검색)
create index idx_chat_sessions_session_id on chat_sessions(session_id);

-- Row Level Security 비활성화 (공개 채팅방)
-- 또는 활성화해서 보안 강화 가능
-- alter table chat_sessions enable row level security;
```

### 2. API 키 복사
- Settings > API에서 URL과 anon key 복사
- `.env.local`에 추가

## 📁 프로젝트 구조

```
geochemistry-analyzer/
├── src/
│   ├── app/
│   │   ├── globals.css
│   │   ├── layout.tsx
│   │   └── page.tsx
│   ├── components/
│   │   ├── AnalysisPanel.tsx
│   │   ├── DataViewer.tsx
│   │   ├── FileUpload.tsx
│   │   └── ScatterPlot.tsx
│   ├── lib/
│   │   ├── statistics.ts
│   │   └── supabase.ts
│   └── types/
│       └── geochem.ts
├── package.json
├── tailwind.config.ts
├── tsconfig.json
└── README.md
```

## 📊 사용법

1. **파일 업로드**: Excel 또는 CSV 파일을 드래그하거나 클릭하여 업로드
2. **변수 선택**: X축과 Y축에 분석할 변수 선택
3. **분석 결과 확인**: 
   - 산점도로 데이터 분포 확인
   - 상관계수 및 유의성 검정 결과 확인
   - 회귀선과 결정계수 확인

## 🚀 Vercel 배포

### 1. Vercel 계정 연결
```bash
npm i -g vercel
vercel login
```

### 2. 배포
```bash
vercel
```

### 3. 환경 변수 설정
Vercel 대시보드에서 환경 변수 추가:
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `OPENAI_API_KEY`

## 🔧 개발 참고사항

### 지원 데이터 형식
- **Excel**: .xlsx, .xls
- **CSV**: 쉼표로 구분된 값
- **헤더**: 첫 번째 행은 컬럼 헤더여야 함
- **수치 데이터**: 자동으로 감지되어 분석에 사용
- **문자 데이터**: 타입 분류에 사용

### 통계 분석
- **피어슨 상관계수**: 선형 관계 측정
- **스피어만 상관계수**: 순위 기반 관계 측정
- **선형 회귀**: 최소제곱법 사용
- **유의성 검정**: t-검정 기반 p-값 계산

## 🤝 기여하기

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## 📝 라이선스

MIT 라이선스에 따라 배포됩니다. 자세한 내용은 `LICENSE` 파일을 참조하세요. 
# 지구화학 데이터 분석기

Next.js + TypeScript + Supabase + Vercel로 구축된 웹 기반 지구화학 데이터 분석 도구입니다.

## 🚀 기능

### 📊 데이터 분석
- **파일 업로드**: Excel (.xlsx) 및 CSV 파일 지원
- **데이터 시각화**: 드래그 앤 드롭으로 쉬운 파일 업로드
- **통계 분석**: 
  - 피어슨 상관계수
  - 스피어만 상관계수  
  - 선형 회귀 분석
  - R-squared 계산
- **인터랙티브 차트**: 산점도와 회귀선 표시
- **타입별 분류**: 암석 타입 등에 따른 데이터 그룹화
- **스캔 모드**: 전체 변수 조합 자동 분석

### 🤖 ChatGPT 4o 통합
- **직접 API 연결**: OpenAI API를 통한 GPT-4o 모델 사용
- **모델 선택**: GPT-4o, GPT-4o-mini, GPT-4, GPT-3.5-turbo 지원
- **논문 작성 도우미**: 학술적 글쓰기 및 연구 질문 지원
- **설정 가능**: Temperature, 시스템 프롬프트, 최대 토큰 등
- **채팅 히스토리**: 대화 내용 저장 및 내보내기
- **반응형 디자인**: 모바일 및 데스크톱 지원

## 🛠️ 기술 스택

- **Frontend**: Next.js 14, TypeScript, Tailwind CSS
- **Charts**: Recharts
- **Database**: Supabase
- **Deployment**: Vercel
- **File Processing**: xlsx, papaparse
- **Statistics**: simple-statistics
- **Icons**: Lucide React

## 📋 설치 및 실행

### 1. Node.js 설치
```bash
# https://nodejs.org에서 LTS 버전 다운로드
# 또는 winget 사용 (Windows)
winget install OpenJS.NodeJS
```

### 2. 의존성 설치
```bash
npm install
```

### 3. 환경 변수 설정
`.env.local` 파일을 생성하고 다음을 추가:
```env
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key

# OpenAI API (선택사항 - ChatGPT 기능용, 클라이언트에서도 설정 가능)
OPENAI_API_KEY=your-openai-api-key
```

### 4. 개발 서버 실행
```bash
npm run dev
```

브라우저에서 [http://localhost:3000](http://localhost:3000)을 열어 확인하세요.

## 🗄️ Supabase 설정

### 1. Supabase 프로젝트 생성
1. [supabase.com](https://supabase.com)에서 새 프로젝트 생성
2. Database > SQL Editor에서 다음 테이블 생성:

```sql
-- 지구화학 데이터 저장 테이블
create table geochem_data (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users default auth.uid(),
  file_name text not null,
  data jsonb not null,
  metadata jsonb not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 채팅 세션 저장 테이블
create table chat_sessions (
  id bigint generated by default as identity primary key,
  session_id text not null,
  user_password text not null,
  messages jsonb not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Row Level Security 활성화
alter table geochem_data enable row level security;
alter table chat_sessions enable row level security;

-- 지구화학 데이터 정책
create policy "Users can insert their own data" on geochem_data
  for insert with check (auth.uid() = user_id);

create policy "Users can view their own data" on geochem_data
  for select using (auth.uid() = user_id);

create policy "Users can update their own data" on geochem_data
  for update using (auth.uid() = user_id);

create policy "Users can delete their own data" on geochem_data
  for delete using (auth.uid() = user_id);

-- 채팅 세션 정책 (비밀번호 기반 접근)
create policy "Anyone can insert chat sessions" on chat_sessions
  for insert with check (true);

create policy "Users can view their own chat sessions" on chat_sessions
  for select using (true);

create policy "Users can update their own chat sessions" on chat_sessions
  for update using (true);

-- 인덱스 추가
create index idx_chat_sessions_session_id on chat_sessions(session_id);
create index idx_chat_sessions_user_password on chat_sessions(user_password);
```

### 2. API 키 복사
- Settings > API에서 URL과 anon key 복사
- `.env.local`에 추가

## 📁 프로젝트 구조

```
geochemistry-analyzer/
├── src/
│   ├── app/
│   │   ├── globals.css
│   │   ├── layout.tsx
│   │   └── page.tsx
│   ├── components/
│   │   ├── AnalysisPanel.tsx
│   │   ├── DataViewer.tsx
│   │   ├── FileUpload.tsx
│   │   └── ScatterPlot.tsx
│   ├── lib/
│   │   ├── statistics.ts
│   │   └── supabase.ts
│   └── types/
│       └── geochem.ts
├── package.json
├── tailwind.config.ts
├── tsconfig.json
└── README.md
```

## 📊 사용법

### 데이터 분석 모드
1. **파일 업로드**: Excel 또는 CSV 파일을 드래그하거나 클릭하여 업로드
2. **변수 선택**: X축과 Y축에 분석할 변수 선택
3. **분석 결과 확인**: 
   - 산점도로 데이터 분포 확인
   - 상관계수 및 유의성 검정 결과 확인
   - 회귀선과 결정계수 확인

### ChatGPT 4o 모드
1. **모드 전환**: 메인 화면에서 "ChatGPT 4o" 버튼 클릭
2. **API 키 설정**: 설정 버튼을 클릭하여 OpenAI API 키 입력
3. **모델 선택**: GPT-4o, GPT-4o-mini 등 원하는 모델 선택
4. **대화 시작**: 논문 작성, 연구 질문 등에 대해 자유롭게 질문
5. **설정 조정**: Temperature, 시스템 프롬프트 등 필요에 따라 조정

## 🚀 Vercel 배포

### 1. Vercel 계정 연결
```bash
npm i -g vercel
vercel login
```

### 2. 배포
```bash
vercel
```

### 3. 환경 변수 설정
Vercel 대시보드에서 환경 변수 추가:
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`

## 🔧 개발 참고사항

### 지원 데이터 형식
- **Excel**: .xlsx, .xls
- **CSV**: 쉼표로 구분된 값
- **헤더**: 첫 번째 행은 컬럼 헤더여야 함
- **수치 데이터**: 자동으로 감지되어 분석에 사용
- **문자 데이터**: 타입 분류에 사용

### 통계 분석
- **피어슨 상관계수**: 선형 관계 측정
- **스피어만 상관계수**: 순위 기반 관계 측정
- **선형 회귀**: 최소제곱법 사용
- **유의성 검정**: t-검정 기반 p-값 계산

## 🤝 기여하기

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## 📝 라이선스

MIT 라이선스에 따라 배포됩니다. 자세한 내용은 `LICENSE` 파일을 참조하세요. 